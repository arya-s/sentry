{% extends "sentry/bases/account.html" %}

{% load crispy_forms_tags %}
{% load i18n %}
{% load sentry_helpers %}

{% block title %}{% trans "Notification Settings" %} | {{ block.super }}{% endblock %}

{% block main %}
  <legend class="m-t-0">Emails</legend>
  {% if request.user.has_unverified_emails %}
    <div class="alert alert-warning alert-block">
      {% trans "You have unverified emails. " %}
      <a href="{% url 'sentry-account-confirm-email-send' %}">{% trans "Resend Verification Emails" %}</a>.
    </div>
  {% endif %}
  {% if emails %}
  <table class="table table-bordered m-b-0">
    <tbody>
    {% for email in emails %}
    <tr>
      <td>
        {{ email.email }}
        {% if email = primary_email %}
        <span class="label verification label-primary">Primary</span>
        {% endif %}
        {% if not email.is_verified %}
        <span class="label verification label-warning">Unverified</span>
        {% else %}
        <span class="label verification label-success">Verified</span>
        {% endif %}
      </td>
      <td>
        {% if email != primary_email and email.is_verified %}
        <form action="" method="post">
          {% csrf_token %}
          <input type='hidden' name='new_primary_email' value={{ email.email }}>
          <button type='submit' name='primary'>Set as Primary Email</button>
        </form>
        {% endif %}
      </td>
      <td style="text-align:center">
        {% if email  != primary_email %}
        <form action="" method="post">
          {% csrf_token %}
          <input type='hidden' name='email' value={{ email.email }}>
          <button type='submit' name='remove' class='btn btn-danger btn-sm remove'><span class="icon-trash"></span></button>
        </form>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
    </tbody>
  </table>
  <p class='help-block'>To use an email for <a href="{% url "sentry-account-settings-notifications" %}">notifications</a> it must be verified</p>
  {% endif %}
  <br>
  <form action="" method="post" class="">
    {% csrf_token %}
    {{ email_form|as_crispy_errors }}
  	{{ email_form.alt_email|as_crispy_field }}

    {% if email_form.password %}
      <legend>{% trans "Verification"  %}</legend>
      {% with email_form.password as field %}
        {{ field|as_crispy_field }}
      {% endwith %}
    {% endif %}

  	<fieldset class="form-actions">
      <button type="submit" class="btn btn-primary">{% trans "Save Changes" %}</button>
    </fieldset>
  </form>
{% endblock %}
